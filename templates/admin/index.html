{% extends "admin/base_site.html" %}
{% load static %}

{% block content %}
<div class="flex flex-col min-h-screen bg-gray-100 p-8 space-y-8">

    <!-- Header -->
    <div class="flex items-center justify-between mb-8">
        <div class="flex items-center space-x-4">
            <img src="{% static 'admin/img/logo-crpay.png' %}" alt="Logo CRPAY" class="h-20 w-20 object-contain">
            <h1 class="text-3xl font-bold text-gray-800">Dashboard CRPAY</h1>
        </div>
    </div>

    <!-- KPIs -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
        <div class="kpi-card">
            <div class="text-sm text-gray-500">Transactions totales</div>
            <div class="text-2xl font-bold text-gray-800">{{ total_transactions }}</div>
        </div>

        <div class="kpi-card">
            <div class="text-sm text-gray-500">Montant total</div>
            <div class="text-2xl font-bold text-gray-800">{{ total_amount }} FCFA</div>
        </div>

        <div class="kpi-card">
            <div class="text-sm text-gray-500">Transactions réussies</div>
            <div class="text-2xl font-bold text-green-600">{{ successful_transactions }}</div>
        </div>

        <div class="kpi-card">
            <div class="text-sm text-gray-500">Transactions échouées</div>
            <div class="text-2xl font-bold text-red-600">{{ failed_transactions }}</div>
        </div>
    </div>

    <!-- Graphiques -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mt-8">
        <div class="bg-white p-6 rounded-xl shadow-md">
            <h2 class="text-lg font-semibold mb-4">Volume de transactions par jour</h2>
            <canvas id="transactionsChart"></canvas>
        </div>

        <div class="bg-white p-6 rounded-xl shadow-md">
            <h2 class="text-lg font-semibold mb-4">Répartition des statuts</h2>
            <canvas id="statusChart"></canvas>
        </div>
    </div>

    <!-- Navigation Buttons -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mt-12">
        <a href="{% url 'admin:entity_entity_changelist' %}" class="dashboard-card group">
            <i class="fas fa-building text-4xl text-gray-500 group-hover:text-green-600 transition"></i>
            <span class="text-lg font-semibold mt-4">Partenaires</span>
        </a>

        <a href="{% url 'admin:entity_appuser_changelist' %}" class="dashboard-card group">
            <i class="fas fa-users text-4xl text-gray-500 group-hover:text-green-600 transition"></i>
            <span class="text-lg font-semibold mt-4">Utilisateurs</span>
        </a>

        <a href="{% url 'admin:transaction_transaction_changelist' %}" class="dashboard-card group">
            <i class="fas fa-exchange-alt text-4xl text-gray-500 group-hover:text-green-600 transition"></i>
            <span class="text-lg font-semibold mt-4">Transactions</span>
        </a>
    </div>

</div>
{% endblock %}

{% block extrahead %}
<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- Style Dashboard -->
<style>
    .kpi-card {
        @apply bg-white p-6 rounded-xl shadow-md flex flex-col items-center justify-center;
    }

    .dashboard-card {
        @apply flex flex-col items-center justify-center bg-white p-8 rounded-2xl shadow-md hover:shadow-xl transition transform hover:-translate-y-1 cursor-pointer text-center;
    }
</style>
{% endblock %}

{% block extrajs %}
<script>
    // Graphique volume de transactions
    const ctx1 = document.getElementById('transactionsChart').getContext('2d');
    const transactionsChart = new Chart(ctx1, {
        type: 'line',
        data: {
            labels: {{ transaction_dates|safe }},
            datasets: [{
                label: 'Nombre de transactions',
                data: {{ transaction_counts|safe }},
                borderColor: '#10B981',
                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                tension: 0.3,
                fill: true
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: { beginAtZero: true }
            }
        }
    });

    // Graphique répartition des statuts
    const ctx2 = document.getElementById('statusChart').getContext('2d');
    const statusChart = new Chart(ctx2, {
        type: 'doughnut',
        data: {
            labels: ['Réussies', 'Échouées', 'En attente'],
            datasets: [{
                data: {{ status_distribution|safe }},
                backgroundColor: ['#10B981', '#EF4444', '#F59E0B']
            }]
        },
        options: {
            responsive: true
        }
    });
</script>
{% endblock %}
